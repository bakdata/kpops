# Migrate from V6 to V7

## [Automatic loading of namespaced custom components](https://github.com/bakdata/kpops/pull/500)

KPOps is now distributed as a Python namespace package (as defined by [PEP 420](https://peps.python.org/pep-0420/)). This allows us to standardize the namespace `kpops.components` for both builtin and custom pipeline components.

As a result of the restructure, some imports need to be adjusted:

**KPOps Python API**

```diff
-import kpops
+import kpops.api as kpops
```

**builtin KPOps components**

```diff
-from kpops.components import (
-    HelmApp,
-    KafkaApp,
-    KafkaConnector,
-    KafkaSinkConnector,
-    KafkaSourceConnector,
-    KubernetesApp,
-    StreamsBootstrap,
-    ProducerApp,
-    StreamsApp,
-    PipelineComponent,
-    StreamsApp,
-    ProducerApp,
-)
+from kpops.components.base_components import (
+    HelmApp,
+    KafkaApp,
+    KafkaConnector,
+    KafkaSinkConnector,
+    KafkaSourceConnector,
+    KubernetesApp,
+    PipelineComponent,
+)
+from kpops.components.streams_bootstrap import (
+    StreamsBootstrap,
+    StreamsApp,
+    ProducerApp,
+)
```

### your custom KPOps components

#### config.yaml

```diff
-components_module: components
```

#### Python module

```diff
-components/__init__.py
+kpops/components/custom/__init__.py
```

## [Call destroy from inside of reset or clean](https://github.com/bakdata/kpops/pull/501)

Before v7, the KPOps CLI executed `destroy` before running `reset/clean` to ensure the component was destroyed.

This logic has changed. From now on, the `destroy` method should be called within the `reset/clean` method if needed by the user.

During the migration to v7, you should check your custom components and see if they are overriding the `reset/clean` methods. If so, you would need to add the `destroy` method at the beginning of your `reset/clean` override.

#### components.py

In the following example, we must call the `destroy` method inside the `clean` method. ** Otherwise, the logic of destroy will not be executed!**

```diff
class MyCustomComponent(PipelineComponent):
    
    @override
    async def destroy(self, dry_run: bool) -> None:
        # Some custom destroy logic
        # ...

    @override
    async def clean(self, dry_run: bool) -> None:
+       destroy(dry_run)
        # Some custom clean logic
        # ...
```
